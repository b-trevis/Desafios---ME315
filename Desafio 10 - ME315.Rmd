---
title: "Desafio 10 teste 3"
author: "Bruce Trevisan"
date: "2025-10-02"
output:
  html_document: default
  pdf_document: default
---

# INTRODUÇÃO OS POLARS

```{python}
#instalando os pacotes necessarios

# !pip install polars
# !pip install fastexcel
# !pip install pyarrow
```


```{python}
# importando os pacotes 

import polars as pl
import fastexcel as fx
import pyarrow
```

```{python}
# Importando o arquivo airports
aeroportos = pl.read_csv("../Documentos/airports.csv",
                         columns = ["IATA_CODE", "CITY", "STATE"])
aeroportos.head(2)
```

```{python}
# Importando o arquivo WDIEXCEL
wdi = pl.read_excel("./WDIEXCEL.xlsx", sheet_name = "Country",
                    columns = ["Short Name", "Region"])
wdi.head(2)
```

```{python}
# Criação de um df com o polars (mais rapido e eficiente)
df = pl.DataFrame({
    "grupo": ["A", "A", "B", "B", "C"],
    "valor1": [10, 15, 10, None, 25],
    "valor2": [5, None, 20, 30, None]
})
df
```

```{python}
# Consulta de valores do df
df["valor1"]

df["valor1"].mean()
```

```{python}
# Limpa os nulos e deixa os números válidos
df["valor1"].drop_nulls()

# Calcula a média dos números válidos
df["valor1"].drop_nulls().mean()
```

```{python}
# Calcula as médias de várias colunas de uma vez só e volta uma tabela com os resultados
df.select([
  pl.col("valor1").mean().alias("media_v1"),
  pl.col("valor2").mean()
])
```

```{python}
# Resumo da estatística por grupo, assim calculando a média de valor 1 e o mínimo de valor 2
df.group_by("grupo").agg([
  pl.col("valor1").mean().alias("media_valor1"),
  pl.col("valor2").min().alias("min_valor2")
]).sort("grupo")
```

```{python}
# pega o dataset de voos e seleciona só as colunas que foram selecionadas e mostra quantas linhas e colunas foram carregadas
voos = pl.read_csv("flights_pasta/flights.csv",
                   columns = ["AIRLINE", "ARRIVAL_DELAY", "DESTINATION_AIRPORT"],
                   dtypes = {"AIRLINE": pl.Utf8,
                             "ARRIVAL_DELAY": pl.Int32,
                             "DESTINATION_AIRPORT": pl.Utf8})
voos.shape
```

```{python}
voos.head(3)
```

```{python}
# Calcula qual a fração de voos que chegaram com mais de 30 minutos de atraso 
resultado = (
  voos.drop_nulls(["AIRLINE", "DESTINATION_AIRPORT", "ARRIVAL_DELAY"])
  .filter(
    pl.col("AIRLINE").is_in(["AA", "DL"]) &
    pl.col("DESTINATION_AIRPORT").is_in(["SEA", "MIA", "BWI"])
    )
    .group_by(["AIRLINE", "DESTINATION_AIRPORT"])
    .agg([
      (pl.col("ARRIVAL_DELAY") > 30).mean().alias("atraso_medio")
      ])
)
```

```{python}
# atraso medio dos voos
resultado.sort("atraso_medio")
```

```{r}
horario_normal <- function(timestamp = Sys.time()) {
  format(timestamp, "%d/%m/%Y %H:%M:%S")
}

cat("Arquivo compilado em:", horario_normal(), "\n")
```
